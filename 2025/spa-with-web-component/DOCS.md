# ウェブコンポーネントを利用したSPAの開発手法

- [ウェブコンポーネントを利用したSPAの開発手法](#ウェブコンポーネントを利用したspaの開発手法)
  - [1. イントロダクション](#1-イントロダクション)
    - [1.1. 目的](#11-目的)
    - [1.2. レポート課題について](#12-レポート課題について)
  - [2. ウェブアプリケーションとは](#2-ウェブアプリケーションとは)
    - [2.1. ウェブアプリケーション](#21-ウェブアプリケーション)
    - [2.2. コンテンツ配信](#22-コンテンツ配信)
    - [2.3. シングルページアプリケーション(SPA)とは](#23-シングルページアプリケーションspaとは)
  - [3. 開発ツール](#3-開発ツール)
    - [3.1. Visual Studio Code](#31-visual-studio-code)
      - [拡張機能](#拡張機能)
      - [ユーザー設定/ワークスペース設定](#ユーザー設定ワークスペース設定)
    - [3.2. ブラウザの開発者ツール](#32-ブラウザの開発者ツール)
      - [3.2.1. 要素タブ（Elementsタブ）](#321-要素タブelementsタブ)
      - [3.2.2. コンソールタブ（Consoleタブ）](#322-コンソールタブconsoleタブ)
      - [3.2.3. ネットワークタブ（Networkタブ）](#323-ネットワークタブnetworkタブ)
      - [3.2.4. アプリケーションタブ（Applicationタブ）](#324-アプリケーションタブapplicationタブ)
  - [4. 開発の準備](#4-開発の準備)
  - [5. HTML](#5-html)
    - [5.1. 要素とタグ](#51-要素とタグ)
    - [5.2. DOCTYPE宣言](#52-doctype宣言)
    - [5.3. 基本的なHTML文書の構成](#53-基本的なhtml文書の構成)
      - [html要素](#html要素)
      - [head要素](#head要素)
      - [body要素](#body要素)
    - [5.4. HTML要素](#54-html要素)
  - [6. CSS](#6-css)
    - [6.1. ボックスモデル](#61-ボックスモデル)
    - [6.2. セレクタ](#62-セレクタ)
    - [6.3. フレックスボックスとグリッドレイアウト](#63-フレックスボックスとグリッドレイアウト)
    - [6.4. CSSカスタムプロパティを利用したスタイリング](#64-cssカスタムプロパティを利用したスタイリング)
  - [7. JavaScript](#7-javascript)
    - [7.1. 基本的な処理](#71-基本的な処理)
    - [7.2. 条件分岐](#72-条件分岐)
    - [7.3. 繰り返し](#73-繰り返し)
    - [7.4. JSDoc](#74-jsdoc)
    - [7.5. コードの再利用](#75-コードの再利用)
    - [7.6. DOMを利用したページの操作](#76-domを利用したページの操作)
  - [8. ウェブコンポーネント](#8-ウェブコンポーネント)
    - [8.1. カスタム要素](#81-カスタム要素)
    - [8.2. ShadowDOM](#82-shadowdom)
  - [9. ウェブコンポーネントを利用したSPAの開発](#9-ウェブコンポーネントを利用したspaの開発)
    - [9.1. ルーティング](#91-ルーティング)
      - [URL](#url)
      - [onHashChange](#onhashchange)
    - [9.2. ディレクトリ構成](#92-ディレクトリ構成)
    - [9.3. デザイン](#93-デザイン)
  - [10. まとめ](#10-まとめ)

## 1. イントロダクション

### 1.1. 目的

この実験ではまず、HTML、CSS、JavaScriptの3つの言語について学習します。
その後、「ウェブコンポーネント」とまとめて呼ばれる一連の技術を学習し、これを利用したシングルページアプリケーション(以下 SPA)の開発手法を体験することを目的とします。

### 1.2. レポート課題について

この実験のレポート課題は、「**📝課題**」というキーワードに続けて示す問題に対し回答を記述するものとします。
また、問題文の末尾には「（n点）」というようにその課題の配点を示します。
レポートには課題の配点の合計が少なくとも6点を超えるよう、資料中に示した課題を複数個選択してレポートを作成してください。

**📝課題**: あなたの好きなうどんのメニュー名を記述しなさい。回答しても配点はありませんが、資料の作者が喜びます。（0点）

## 2. ウェブアプリケーションとは

### 2.1. ウェブアプリケーション

「アプリケーションソフトウェア」とは、コンピュータ上で特定の作業や処理を行うために作成されたソフトウェアのことです。単に「アプリケーション」と言うこともあります。

このうち、OS（基本ソフトウェア）にインストールして利用するアプリケーションのことを「ネイティブアプリケーション」と言います。  
例えば、ウェブブラウザやオフィスソフトウェアなどがこれに該当します。

このネイティブアプリケーションに対して、ウェブブラウザ上でソフトウェアのインストール無しに動作するアプリケーションのことを「ウェブアプリケーション」と言います。
コンピュータにインストールされたウェブブラウザを利用して、ブラウザ上で特定の作業や処理を行うソフトウェアがウェブアプリケーションということになります。

例えば、みなさんが利用している通信販売サービスや動画投稿サイトなどもウェブアプリケーションに該当します。

**📝課題**: ウェブアプリケーションとウェブサイトの違いを調べ、「双方向」という言葉を使って説明しなさい。（1点）

### 2.2. コンテンツ配信

世の中のモノは、何らかの方法で人からアクセス可能でなければ、見たり使ったりすることができません。  
例えば、有名な写真家でも個展やSNSでの発信がなければ、撮影した写真が日の目を見ることはありません。

アプリケーションも同様に、ユーザーがそれを利用するにはユーザーにアプリケーションを届ける仕組みが必要です。この仕組みをコンテンツ配信と言います。  
例えば、スマートフォン上で動作するネイティブアプリケーションは、OSがAndroidであればPlayストア、iOSであればApp Storeで配信され、ユーザーは自由にインストールして利用することが可能です。

ウェブアプリケーションでは、この部分はウェブサーバーが担います。  
これによって、ブラウザからアプリケーションに対してアクセスすることができ、ユーザーからアプリケーションが利用可能になります。

今回の実験ではコンテンツ配信についてはこれ以降解説しません。  
もし興味があれば、以下の資料やサイトを参考に自分で調べて取り組んでみてください。

- [はじめの一歩は時間割 - 9. アプリを公開しよう](https://github.com/jigintern/study_session_materials/blob/main/2024/web-timetable/DOCS.md#9-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E5%85%AC%E9%96%8B%E3%81%97%E3%82%88%E3%81%86)
- [GitHub Pagesの使い方 - ウェブ開発の学習|MDN](https://developer.mozilla.org/ja/docs/Learn_web_development/Howto/Tools_and_setup/Using_GitHub_pages)

### 2.3. シングルページアプリケーション(SPA)とは

さて、ウェブアプリケーションについては [2.1. ウェブアプリケーション](#21-ウェブアプリケーション) で説明したとおりです。  
しかし、ウェブアプリケーションと一口に言っても、その動作や仕組みによって細かく分類されています。

ここでは「シングルページアプリケーション」（Simgle Page Application:以下SPAと略す）を説明します。

ウェブアプリケーションは基本的にHTML/CSS/JavaScriptという3つの言語を利用して動作しています。  
このうち、HTMLのファイルを一つだけ利用し、JavaScriptによってHTMLに変更を加えて動作させるような仕組みのウェブアプリケーションのことをSPAと言います。
一度HTMLファイルをウェブサーバーから取得したあとはブラウザ上のみで表示の切り替えを行うため、複雑で動的に動作する必要なアプリケーションに適しています。

これに対して、複数のHTMLファイルを作成して、これらをリンクなどで相互に移動できるようにすることでアプリケーションを作成しているものを「マルチページアプリケーション」（Multi Page Application）と言います。
こちらはブラウザで行う処理が少なくなるため、よりスペックの低い端末でもアプリケーションを利用したい場合に適しています。

## 3. 開発ツール

### 3.1. Visual Studio Code

[Visual Studio Code](https://code.visualstudio.com/)（以下 VSCode）はMicrosoftが開発しているエディタです。  
多数の環境設定や豊富な拡張機能から生まれる高いカスタマイズ性が魅力のエディタで、直近ではGitHub Copilotを利用したAIによるコード生成支援などもサポートされ話題になりました。

ここでは、VSCodeを今回の実験で利用しやすいようにカスタマイズするため、いくつかの拡張機能とおすすめの環境設定を紹介します。

#### 拡張機能

VSCodeには標準では実装されていない機能を追加できる「拡張機能」があります。   
公開された拡張機能から必要なものをインストールして利用する形です。

ここでは、今回の実験で必須になるものと、必須ではないがインストールを推奨するものに分けていくつか紹介します。
必須のものに関しては必ずインストールしておくようにしてください。

以下の画像の赤線で囲ったアイコンから拡張機能パネルを開くことができます。

![VSCodeの拡張機能サイドパネルを開くアイコンの位置](imgs/open-vscode-extensions.png)

開いたパネルの検索窓に以下の拡張機能の名前を入力して検索し、インストールしてください。

![VSCodeの拡張機能の検索とインストールボタン](imgs/install-vscode-extension.png)

* 必須 
  * [Live Server](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer)
    * エディタで開いているHTMLファイルを簡易ウェブサーバーをローカルに作成してブラウザから閲覧可能にできる
  * [es6-string-html](https://marketplace.visualstudio.com/items?itemName=Tobermory.es6-string-html)
    * JavaScript中にテンプレートリテラルを利用して記述されるHTMLやCSSに対して、特定のコメントをつけることでシンタックスハイライトを有効にできる
* 推奨
  * [Japanese Language Pack for Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=MS-CEINTL.vscode-language-pack-ja)
    * VSCodeを日本語化できる言語パック
  * [vscode-icons](https://marketplace.visualstudio.com/items?itemName=vscode-icons-team.vscode-icons)
    * エクスプローラーで表示されるファイルやディレクトリのアイコンが拡張子や名前によって変更される
  * [Prettier - Code formatter](https://marketplace.visualstudio.com/items/?itemName=esbenp.prettier-vscode)
    * ウェブ開発に利用する各言語に対して、決められたルールをもとにコードスタイルをフォーマットできる

#### ユーザー設定/ワークスペース設定

VSCodeには「ユーザー設定」と「ワークスペース設定」の2種類の環境設定があります。  
「ユーザー設定」はVSCodeを利用する端末毎の環境設定で、これに対して「ワークスペース設定」はVSCodeで開いたディレクトリに保存される設定です。  

それぞれ、ユーザー設定は開発する言語などによらず設定したいもの（ミニマップの非表示など）や自分だけに適用されていればいい設定をするのに便利で、ワークスペース設定はチームで共通のコーディングルールを設定したいとき（インデントをタブ/スペースのどちらで設定するかなど）に便利です。

今回はユーザー設定に指定しておくと便利な設定を紹介します。  
設定画面は`Ctrl(cmd) + Shift + P`のショートカットで呼び出せるコマンドパレットに「Settings」と入力して、「基本設定: ユーザー設定を開く(JSON)」を選択してEnter(return)を押すと開けます。

開いたファイルに以下の内容を貼り付けてください。

```json
{
  "editor.wordWrap": "on",
  "editor.formatOnSave": true,
  "editor.renderWhitespace": "all",
  "editor.tabSize": 2,
  "editor.minimap.enabled": false,
}
```

上から順に、以下の設定内容になっています。

* エディタの端で行を折り返すかどうか: 折り返す
* ファイルの保存時にフォーマットするか: フォーマットする
* 空白文字を表示するか: 表示する
* インデントをスペース何文字で表現するか: 2文字
* ミニマップを表示するか: 表示しない

このほかにも多くの設定項目があります。  
ここで紹介した設定はあくまで筆者が使いやすいものから抜粋した設定です。
また、JSONファイルを編集して設定する他に、GUIからの設定も可能です。更に言語ごとの設定も可能なので、自分好みの設定を求めてカスタマイズすると良いでしょう。  

**📝課題**: 拡張機能で推奨とした「Prettier - Code Formatter」は上記設定では有効になりません。コマンドパレットから言語固有の設定を構成して、HTML、CSS、JavaScriptの3言語でデフォルトのフォーマッターがPrettierになるように設定し、その結果のユーザー設定のJSONファイルを示しなさい。（課題以外の設定が含まれていても構いません）（1点）

### 3.2. ブラウザの開発者ツール

> 要素タブ、スタイルタブ、コンソールタブ、アプリケーションタブ

現在のブラウザには非常に強力な開発者ツールが搭載されており、ウェブ開発で非常に役に立ちます。
ここでは、開発者ツールのいくつかのタブについて説明します。

ブラウザで新しいタブを開いてください。  
URLバーの右のほうにある「⋯」や「︙」のボタンをクリックして、表示されたメニューから「その他のツール」の中に「デベロッパーツール」や「開発者ツール」という項目があるのでクリックすると開発者ツールを開くことができます。 

#### 3.2.1. 要素タブ（Elementsタブ）

要素タブでは、表示しているウェブページのソースを確認することができます。

ここには「HTML」というWebページの構造を表現する言語が表示されています。また、タブの下部には「CSS」というWebページの要素の表示を変更する言語が表示されています。

画面の表示が意図したものでないときはこのタブを開いて、左上にある要素選択ツールから気になる場所を選択してHTMLの内容を確認できます。

![要素タブを開いた状態](../../2024/web-timetable/basic-web-development/imgs/devtool-elements.png)

また、下部に更にタブが表示されています。上の画像ではStyleタブになっていて、ここではCSSで適用されているスタイルを確認できます。  
下部ペインのタブを計算済み（Computed）に切り替えると要素の大きさをグラフィカルに確認することができます。

![要素タブを開いた状態](imgs/devtool-computed.png)

#### 3.2.2. コンソールタブ（Consoleタブ）

コンソールタブは、ページ内のJavaScriptが実行中に出力したログを確認したり、簡単なJavaScriptを実行する事ができます。  
JavaScriptについては後述します。

![コンソールタブを開いた状態](../../2024/web-timetable/basic-web-development/imgs/devtool-console.png)

#### 3.2.3. ネットワークタブ（Networkタブ）

ネットワークタブでは、ページがダウンロードするリソースを確認したり、ページを閲覧するために転送されたデータ量やかかった時間を確認することができます。

GitHub Pagesを利用するような場合にはローカルの開発環境とファイルの置き場所が異なり、うまくファイルがダウンロードできていないことがあります。  
そういった原因による不具合が考える場合にはネットワークタブでリソースがちゃんとダウンロードできているかどうかを確認すると便利です。

![ネットワークタブを開いた状態](../../2024/web-timetable/basic-web-development/imgs/devtool-network.png)

**📝課題**: ネットワークタブには「スロットリング」という良くない通信状況を再現する開発支援の機能があります。これを「No throttling」としたときと「3G」としたときのそれぞれで福井高専のホームページトップにアクセスし、それぞれでページのレンダリング終了までの時間を確認して表に示しなさい。ただし、キャッシュを利用するとスロットリングが有効でもレンダリング終了までの時間が短くなるので、キャッシュを無効にした状態で確認してください。（1点）

#### 3.2.4. アプリケーションタブ（Applicationタブ）

アプリケーションタブでは、ページ毎のキャッシュやローカルデータの確認ができます。
特に、LocalStorage等のブラウザAPIを利用するような場合に動作テストなどが簡単になり便利です。

![アプリケーションタブを開いた状態](../../2024/web-timetable/basic-web-development/imgs/devtool-application.png)

## 4. 開発の準備

> 作業ディレクトリの作成

これ以降各種ウェブ技術を学習していきます。  
その前に、今回の実験で利用するディレクトリを準備しておきましょう。

OSに依存せずに説明できる用に、今回はコマンドラインからディレクトリを作成します。  
以下のコマンドをそれぞれ実行してください。

```sh
cd #ホームディレクトリに移動
mkdir dev #ホームディレクトリ直下にdevという名前のディレクトリを作成
cd dev #作成したdevディレクトリに移動
mkdir spa-with-web-component #今回の実験用のディレクトリを作成
```

（もし、実験で使うディレクトリをもともと決めていたり、開発用につかうディレクトリを決めているのであればその中に作成してもらって大丈夫です。）

これで、Windowsであれば`C:/Users/<自分のユーザー名>/dev/spa-with-web-component`が、MacやLinuxであれば`/Users/<自分のユーザー名>/dev/spa-with-web-component`が作成されます。
VSCodeを起動し、メニューの「ファイル」から「フォルダーを開く」でこのディレクトリを探して開いてください。

## 5. HTML

HTML(Hyper Text Markup Language)

### 5.1. 要素とタグ

> マークアップ、開きタグ、閉じタグ、属性、空要素
> h1タグ

### 5.2. DOCTYPE宣言

> 後方互換モード
> 有り無しで試す

### 5.3. 基本的なHTML文書の構成

#### html要素

> mdn HTMLリファレンス を見てみる

#### head要素

> メタデータコンテンツ, meta, link, title

#### body要素

> フローコンテンツ

### 5.4. HTML要素

> p, h1~h6, ul, ol, li, span, div, 

## 6. CSS

CSS(Cascading Style Sheet)

### 6.1. ボックスモデル

### 6.2. セレクタ

> 要素、クラス、ID、属性、結合子

### 6.3. フレックスボックスとグリッドレイアウト

### 6.4. CSSカスタムプロパティを利用したスタイリング

## 7. JavaScript

### 7.1. 基本的な処理

> 変数、四則演算、Mathオブジェクト、文字列の処理、論理演算

### 7.2. 条件分岐

> 比較演算子、if文、三項演算子

### 7.3. 繰り返し

> 配列、for文、Arrayオブジェクト反復処理メソッド

### 7.4. JSDoc

> 型、TypeScript、エディタによる開発支援

### 7.5. コードの再利用

> 関数、オブジェクト、クラス、インスタンス

### 7.6. DOMを利用したページの操作

> DOM、setHTMLUnsafe、XSS

## 8. ウェブコンポーネント

### 8.1. カスタム要素

> カスタム要素の命名規則

### 8.2. ShadowDOM

> カプセル化

## 9. ウェブコンポーネントを利用したSPAの開発

> TODOアプリを作成する

### 9.1. ルーティング

> ルーティングとは

#### URL

> スキーム、ドメイン、ポート、パス、クエリパラメータ、ハッシュ

#### onHashChange

> イベントリスナー

### 9.2. ディレクトリ構成

> ファイルの責任範囲、ディレクトリ構成、命名規則

### 9.3. デザイン

> UI、オブジェクト、CRUD

## 10. まとめ

> ウェブコンポーネントとは、SPAとは、効率的なウェブアプリケーションの開発に有効な手段とは

